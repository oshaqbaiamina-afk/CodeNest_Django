<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeNest - ”ò–∫—ñ–º—à—ñ –ø–∞–Ω–µ–ª—ñ</title>

    {% if user.is_authenticated %}
    <meta name="user-email" content="{{ user.email }}">
    <meta name="user-role" content="{{ user.role }}">
    <meta name="user-name" content="{{ user.full_name }}">
    {% endif %}

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background:
                radial-gradient(ellipse at top left, rgba(102, 126, 234, 0.4), transparent 50%),
                radial-gradient(ellipse at top right, rgba(240, 147, 251, 0.4), transparent 50%),
                radial-gradient(ellipse at bottom left, rgba(56, 239, 125, 0.4), transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(79, 172, 254, 0.4), transparent 50%),
                linear-gradient(135deg, #667eea 0%, #764ba2 20%, #f093fb 40%, #4facfe 60%, #00f2fe 80%, #667eea 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 20s ease infinite;
            color: #333;
            min-height: 100vh;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 50%; }
            50% { background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 100% 50%; }
            100% { background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 50%; }
        }

        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 1.2rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            font-size: 2rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 2px 10px rgba(102, 126, 234, 0.5);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: '</>';
            font-size: 2.5rem;
            background: linear-gradient(135deg, #11998e, #38ef7d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-badge {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            margin-left: 1rem;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 0.8rem 1.8rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: white;
            color: #667eea;
        }

        .container {
            max-width: 1600px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 3.5rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.6), 0 0 25px rgba(0, 0, 0, 0.4);
            letter-spacing: 1px;
        }

        .stat-label {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
            letter-spacing: 0.3px;
        }

        .section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2.8rem;
            color: white;
            font-weight: 900;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.6), 0 0 25px rgba(0, 0, 0, 0.4);
            letter-spacing: 0.5px;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid transparent;
            color: white;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.15rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .btn-sm {
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
        }

        .search-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .search-input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.4);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }

        .table-container {
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 1.2rem;
            text-align: left;
            font-weight: 800;
            font-size: 1.2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
            letter-spacing: 0.3px;
        }

        td {
            padding: 1.2rem;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }

        .badge-warning {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .badge-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.2);
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(135deg, #11998e, #38ef7d);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .export-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: white;
            font-size: 1.2rem;
        }

        .error-message {
            background: rgba(245, 87, 108, 0.2);
            border: 2px solid #f5576c;
            color: white;
            padding: 1rem;
            border-radius: 15px;
            margin: 1rem 0;
        }

        .filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .form-select {
            padding: 0.8rem 1.2rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .form-select option {
            background: #667eea;
            color: white;
        }

        /* –ú–æ–¥–∞–ª—å–¥—ã —Ç–µ—Ä–µ–∑–µ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
            padding: 2.5rem;
            border-radius: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: white;
            color: #667eea;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-input:focus {
            outline: none;
            border-color: white;
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div style="display: flex; align-items: center;">
            <div class="logo">CodeNest</div>
            <span class="admin-badge">üëë {{ user.get_role_display|upper }}</span>
        </div>
        <button class="logout-btn" onclick="handleLogout()">üö™ –®—ã“ì—É</button>
    </nav>

    <div class="container">
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-value" id="totalStudents">-</div>
                <div class="stat-label">–ë–∞—Ä–ª—ã“õ –æ“õ—É—à—ã–ª–∞—Ä</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë®‚Äçüè´</div>
                <div class="stat-value" id="totalTeachers">-</div>
                <div class="stat-label">–ú“±“ì–∞–ª—ñ–º–¥–µ—Ä</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-value" id="totalCourses">4</div>
                <div class="stat-label">–ë–µ–ª—Å–µ–Ω–¥—ñ –∫—É—Ä—Å—Ç–∞—Ä</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-value" id="avgScore">-</div>
                <div class="stat-label">–û—Ä—Ç–∞—à–∞ –±–∞–ª–ª</div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">–ñ“Ø–π–µ–Ω—ñ –±–∞—Å“õ–∞—Ä—É</h2>
                <button class="export-btn" onclick="exportData()">üì• –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —ç–∫—Å–ø–æ—Ä—Ç—Ç–∞—É</button>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('students')">üë• –û“õ—É—à—ã–ª–∞—Ä</button>
                <button class="tab-btn" onclick="switchTab('teachers')">üë®‚Äçüè´ –ú“±“ì–∞–ª—ñ–º–¥–µ—Ä</button>
                <button class="tab-btn" onclick="switchTab('grades')">üéØ –ë–∞“ì–∞–ª–∞—Ä</button>
                <button class="tab-btn" onclick="switchTab('analytics')">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            </div>

            <div id="students-tab" class="tab-content active">
                <div class="search-bar">
                    <input type="text" class="search-input" id="studentSearch" placeholder="üîç –ê—Ç—ã, email –Ω–µ–º–µ—Å–µ ID –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É..." onkeyup="searchStudents()">
                    <button class="btn btn-success" onclick="openAddStudentModal()">‚ûï –û“õ—É—à—ã “õ–æ—Å—É</button>
                </div>

                <div class="filter-bar">
                    <select class="form-select" id="statusFilter" onchange="filterStudents()">
                        <option value="">–ë–∞—Ä–ª—ã“õ –º”ô—Ä—Ç–µ–±–µ–ª–µ—Ä</option>
                        <option value="true">–ë–µ–ª—Å–µ–Ω–¥—ñ</option>
                        <option value="false">–ë–µ–ª—Å–µ–Ω–¥—ñ –µ–º–µ—Å</option>
                    </select>
                </div>

                <div class="table-container">
                    <table id="studentsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ê—Ç—ã</th>
                                <th>Email</th>
                                <th>–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω –∫“Ø–Ω—ñ</th>
                                <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                                <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                                <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            <tr>
                                <td colspan="7" class="loading">‚è≥ –î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="teachers-tab" class="tab-content">
                <div class="search-bar">
                    <input type="text" class="search-input" id="teacherSearch" placeholder="üîç –ú“±“ì–∞–ª—ñ–º–¥–µ—Ä–¥—ñ —ñ–∑–¥–µ—É..." onkeyup="searchTeachers()">
                    <button class="btn btn-success" onclick="openAddTeacherModal()">‚ûï –ú“±“ì–∞–ª—ñ–º “õ–æ—Å—É</button>
                </div>

                <div class="table-container">
                    <table id="teachersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ê—Ç—ã</th>
                                <th>Email</th>
                                <th>–ö—É—Ä—Å</th>
                                <th>–û“õ—É—à—ã —Å–∞–Ω—ã</th>
                                <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                                <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                            </tr>
                        </thead>
                        <tbody id="teachersTableBody">
                            <tr>
                                <td colspan="7" class="loading">‚è≥ –î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="grades-tab" class="tab-content">
                <div class="search-bar">
                    <input type="text" class="search-input" id="gradeSearch" placeholder="üîç –ë–∞“ì–∞–ª–∞—Ä–¥—ã —ñ–∑–¥–µ—É..." onkeyup="searchGrades()">
                    <select class="form-select" style="width: auto;" id="gradeCourseFilter" onchange="filterGrades()">
                        <option value="">–ë–∞—Ä–ª—ã“õ –∫—É—Ä—Å—Ç–∞—Ä</option>
                        <option value="Web Development">Web Development</option>
                        <option value="Python Programming">Python Programming</option>
                        <option value="JavaScript">JavaScript</option>
                        <option value="SQL Database">SQL Database</option>
                    </select>
                </div>

                <div class="table-container">
                    <table id="gradesTable">
                        <thead>
                            <tr>
                                <th>–û“õ—É—à—ã</th>
                                <th>–ú“±“ì–∞–ª—ñ–º</th>
                                <th>–ö—É—Ä—Å</th>
                                <th>–°–∞–±–∞“õ</th>
                                <th>–ë–∞“ì–∞</th>
                                <th>–ö“Ø–Ω—ñ</th>
                            </tr>
                        </thead>
                        <tbody id="gradesTableBody">
                            <tr>
                                <td colspan="6" class="loading">‚è≥ –î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="analytics-tab" class="tab-content">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-value" id="avgTimeHours">-</div>
                        <div class="stat-label">–û—Ä—Ç–∞—à–∞ –æ“õ—É —É–∞“õ—ã—Ç—ã</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-value" id="completionRate">-</div>
                        <div class="stat-label">–ê—è“õ—Ç–∞—É –ø–∞–π—ã–∑—ã</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üíØ</div>
                        <div class="stat-value" id="perfectScores">-</div>
                        <div class="stat-label">–¢–∞–º–∞—à–∞ –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-value" id="totalLessons">-</div>
                        <div class="stat-label">–ë–∞—Ä–ª—ã“õ —Å–∞–±–∞“õ—Ç–∞—Ä</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="studentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="studentModalTitle">–û“õ—É—à—ã “õ–æ—Å—É</h3>
                <button class="close-btn" onclick="closeStudentModal()">√ó</button>
            </div>
            <form id="studentForm">
                <input type="hidden" id="studentId">
                <div class="form-group">
                    <label class="form-label">–ê—Ç—ã</label>
                    <input type="text" class="form-input" id="studentName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="studentEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">“ö“±–ø–∏—è —Å”©–∑ (”©“£–¥–µ—É “Ø—à—ñ–Ω –±–æ—Å “õ–∞–ª–¥—ã—Ä—ã“£—ã–∑)</label>
                    <input type="password" class="form-input" id="studentPassword">
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">–°–∞“õ—Ç–∞—É</button>
                    <button type="button" class="btn" onclick="closeStudentModal()" style="flex: 1;">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="teacherModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="teacherModalTitle">–ú“±“ì–∞–ª—ñ–º “õ–æ—Å—É</h3>
                <button class="close-btn" onclick="closeTeacherModal()">√ó</button>
            </div>
            <form id="teacherForm">
                <input type="hidden" id="teacherId">
                <div class="form-group">
                    <label class="form-label">–ê—Ç—ã</label>
                    <input type="text" class="form-input" id="teacherName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="teacherEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">“ö“±–ø–∏—è —Å”©–∑</label>
                    <input type="password" class="form-input" id="teacherPassword">
                </div>
                <div class="form-group">
                    <label class="form-label">–ö—É—Ä—Å</label>
                    <select class="form-select" id="teacherCourse" style="width: 100%;" required>
                        <option value="">–ö—É—Ä—Å—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑</option>
                        <option value="1">Web Development</option>
                        <option value="2">Python Programming</option>
                        <option value="3">JavaScript</option>
                        <option value="4">SQL Database</option>
                    </select>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">–°–∞“õ—Ç–∞—É</button>
                    <button type="button" class="btn" onclick="closeTeacherModal()" style="flex: 1;">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // CSRF Token
        function getCSRFToken() {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.startsWith('csrftoken=')) {
                        cookieValue = decodeURIComponent(cookie.substring(10));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        let allStudents = [];
        let allTeachers = [];
        let allGrades = [];
        let studentsDataCache = {};

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            loadStudents();
            loadTeachers();
            loadGrades();
            calculateAnalytics();
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            if (tabName === 'analytics') {
                calculateAnalytics();
            } else if (tabName === 'teachers') {
                loadTeachers();
            } else if (tabName === 'grades') {
                loadGrades();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        async function loadStudents() {
            try {
                const response = await fetch('/api/admin/students/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load students');
                }

                const data = await response.json();
                allStudents = data.students;

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑ localStorage –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
                allStudents.forEach(student => {
                    studentsDataCache[student.email] = getStudentProgress(student.email);
                });

                renderStudents(allStudents);
                updateStatistics();

            } catch (error) {
                console.error('Error loading students:', error);
                document.getElementById('studentsTableBody').innerHTML = `
                    <tr><td colspan="7" class="error-message">‚ùå –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ: ${error.message}</td></tr>
                `;
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏–∑ localStorage
        function getStudentProgress(email) {
            const courses = ['course_webdep', 'course_python', 'course_js', 'course_sql'];
            let totalProgress = 0;
            let totalTime = 0;
            let completedCourses = 0;
            let perfectScores = 0;
            let totalScores = 0;
            let scoreCount = 0;

            courses.forEach(courseKey => {
                const userKey = `${courseKey}_${email}`;
                const data = localStorage.getItem(userKey);

                if (data) {
                    try {
                        const courseData = JSON.parse(data);

                        if (courseData.total_lessons && courseData.total_lessons > 0) {
                            const progress = (courseData.completed_lessons / courseData.total_lessons) * 100;
                            totalProgress += progress;

                            if (progress === 100) completedCourses++;
                        }

                        if (courseData.time_seconds) {
                            totalTime += courseData.time_seconds;
                        }

                        if (courseData.test_scores) {
                            courseData.test_scores.forEach(test => {
                                if (test.percentage !== undefined) {
                                    totalScores += test.percentage;
                                    scoreCount++;
                                    if (test.percentage === 100) perfectScores++;
                                }
                            });
                        }
                    } catch (e) {
                        console.error(`Error parsing data for ${userKey}:`, e);
                    }
                }
            });

            const avgProgress = Math.round(totalProgress / courses.length);
            const avgScore = scoreCount > 0 ? Math.round(totalScores / scoreCount) : 0;

            return {
                avgProgress,
                avgScore,
                totalTime,
                completedCourses,
                perfectScores,
                scoreCount
            };
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        function renderStudents(students) {
            const tbody = document.getElementById('studentsTableBody');

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: white;">–û“õ—É—à—ã–ª–∞—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã</td></tr>';
                return;
            }

            tbody.innerHTML = '';

            students.forEach(student => {
                const progress = studentsDataCache[student.email];
                const tr = document.createElement('tr');

                tr.innerHTML = `
                    <td>#${student.id}</td>
                    <td><strong>${student.name}</strong></td>
                    <td>${student.email}</td>
                    <td>${student.date_joined}</td>
                    <td>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${progress.avgProgress}%"></div>
                        </div>
                        <small style="color: rgba(255,255,255,0.8)">${progress.avgProgress}%</small>
                    </td>
                    <td>
                        <span class="badge badge-${student.is_active ? 'success' : 'warning'}">
                            ${student.is_active ? '–ë–µ–ª—Å–µ–Ω–¥—ñ' : '–ë–µ–ª—Å–µ–Ω–¥—ñ –µ–º–µ—Å'}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm" onclick="viewStudent(${student.id}, '${student.email}')">üëÅÔ∏è</button>
                        <button class="btn btn-sm ${student.is_active ? 'btn-danger' : 'btn-success'}"
                                onclick="toggleStudentStatus(${student.id}, ${!student.is_active})">
                            ${student.is_active ? 'üö´' : '‚úÖ'}
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteStudent(${student.id})">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ü–µ–Ω–æ–∫
        async function loadGrades() {
            try {
                const response = await fetch('/api/admin/grades/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load grades');
                }

                const data = await response.json();
                allGrades = data.grades || [];

                renderGrades(allGrades);

            } catch (error) {
                console.error('Error loading grades:', error);
                document.getElementById('gradesTableBody').innerHTML = `
                    <tr><td colspan="6" class="error-message">‚ùå –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ: ${error.message}</td></tr>
                `;
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –æ—Ü–µ–Ω–æ–∫
        function renderGrades(grades) {
            const tbody = document.getElementById('gradesTableBody');

            if (grades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: white;">–ë–∞“ì–∞–ª–∞—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã</td></tr>';
                return;
            }

            tbody.innerHTML = grades.map(grade => `
                <tr>
                    <td><strong>${grade.student_name}</strong></td>
                    <td>${grade.teacher_name}</td>
                    <td>${grade.course_name}</td>
                    <td>${grade.lesson_title}</td>
                    <td>
                        <span class="badge badge-${grade.grade >= 90 ? 'success' : grade.grade >= 70 ? 'info' : 'warning'}">
                            ${grade.grade}%
                        </span>
                    </td>
                    <td>${grade.graded_date}</td>
                </tr>
            `).join('');
        }

        // –ü–æ–∏—Å–∫ –æ—Ü–µ–Ω–æ–∫
        function searchGrades() {
            const query = document.getElementById('gradeSearch').value.toLowerCase();

            const filtered = allGrades.filter(g =>
                g.student_name.toLowerCase().includes(query) ||
                g.teacher_name.toLowerCase().includes(query) ||
                g.lesson_title.toLowerCase().includes(query)
            );

            renderGrades(filtered);
        }

        // –§–∏–ª—å—Ç—Ä –æ—Ü–µ–Ω–æ–∫ –ø–æ –∫—É—Ä—Å—É
        function filterGrades() {
            const courseFilter = document.getElementById('gradeCourseFilter').value;

            let filtered = allGrades;

            if (courseFilter !== '') {
                filtered = filtered.filter(g => g.course_name === courseFilter);
            }

            renderGrades(filtered);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—á–∏—Ç–µ–ª–µ–π
        async function loadTeachers() {
            try {
                const response = await fetch('/api/admin/teachers/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load teachers');
                }

                const data = await response.json();
                allTeachers = data.teachers || [];

                renderTeachers(allTeachers);
                updateTeacherStats();

            } catch (error) {
                console.error('Error loading teachers:', error);
                document.getElementById('teachersTableBody').innerHTML = `
                    <tr><td colspan="7" class="error-message">‚ùå –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ: ${error.message}</td></tr>
                `;
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã —É—á–∏—Ç–µ–ª–µ–π
        function renderTeachers(teachers) {
            const tbody = document.getElementById('teachersTableBody');

            if (teachers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: white;">–ú“±“ì–∞–ª—ñ–º–¥–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã</td></tr>';
                return;
            }

            tbody.innerHTML = teachers.map(teacher => `
                <tr>
                    <td>#${teacher.id}</td>
                    <td><strong>${teacher.name}</strong></td>
                    <td>${teacher.email}</td>
                    <td>${teacher.course_name || '–¢–∞“ì–∞–π—ã–Ω–¥–∞–ª–º–∞“ì–∞–Ω'}</td>
                    <td>${teacher.students_count || 0}</td>
                    <td>
                        <span class="badge badge-${teacher.is_active ? 'success' : 'warning'}">
                            ${teacher.is_active ? '–ë–µ–ª—Å–µ–Ω–¥—ñ' : '–ë–µ–ª—Å–µ–Ω–¥—ñ –µ–º–µ—Å'}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm" onclick="viewTeacher(${teacher.id})">üëÅÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTeacher(${teacher.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatistics() {
            document.getElementById('totalStudents').textContent = allStudents.length;

            let totalScore = 0;
            let scoreCount = 0;

            allStudents.forEach(student => {
                const progress = studentsDataCache[student.email];
                if (progress.avgScore > 0) {
                    totalScore += progress.avgScore;
                    scoreCount++;
                }
            });

            const avgScore = scoreCount > 0 ? Math.round(totalScore / scoreCount) : 0;
            document.getElementById('avgScore').textContent = avgScore + '%';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É—á–∏—Ç–µ–ª–µ–π
        function updateTeacherStats() {
            document.getElementById('totalTeachers').textContent = allTeachers.length;
        }

        // –ü–æ–¥—Å—á–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function calculateAnalytics() {
            let totalTime = 0;
            let completedCount = 0;
            let perfectCount = 0;
            let studentCount = 0;

            allStudents.forEach(student => {
                const progress = studentsDataCache[student.email];
                totalTime += progress.totalTime;
                completedCount += progress.completedCourses;
                perfectCount += progress.perfectScores;
                if (progress.avgProgress > 0) studentCount++;
            });

            const avgTimeHours = studentCount > 0 ? (totalTime / studentCount / 3600).toFixed(1) : 0;
            const completionRate = studentCount > 0 ? Math.round((completedCount / (studentCount * 4)) * 100) : 0;

            document.getElementById('avgTimeHours').textContent = avgTimeHours + ' —Å–∞“ì';
            document.getElementById('completionRate').textContent = completionRate + '%';
            document.getElementById('perfectScores').textContent = perfectCount;

            // –ü–æ–¥—Å—á–µ—Ç —É—Ä–æ–∫–æ–≤
            const totalLessons = allTeachers.reduce((sum, t) => sum + (t.lessons_count || 0), 0);
            document.getElementById('totalLessons').textContent = totalLessons;
        }

        // –ü–æ–∏—Å–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        function searchStudents() {
            const query = document.getElementById('studentSearch').value.toLowerCase();

            const filtered = allStudents.filter(s =>
                s.name.toLowerCase().includes(query) ||
                s.email.toLowerCase().includes(query) ||
                s.id.toString().includes(query)
            );

            renderStudents(filtered);
        }

        // –ü–æ–∏—Å–∫ —É—á–∏—Ç–µ–ª–µ–π
        function searchTeachers() {
            const query = document.getElementById('teacherSearch').value.toLowerCase();

            const filtered = allTeachers.filter(t =>
                t.name.toLowerCase().includes(query) ||
                t.email.toLowerCase().includes(query) ||
                t.id.toString().includes(query)
            );

            renderTeachers(filtered);
        }

        // –§–∏–ª—å—Ç—Ä —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        function filterStudents() {
            const statusFilter = document.getElementById('statusFilter').value;

            let filtered = allStudents;

            if (statusFilter !== '') {
                const isActive = statusFilter === 'true';
                filtered = filtered.filter(s => s.is_active === isActive);
            }

            renderStudents(filtered);
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–∞
        function viewStudent(id, email) {
            const student = allStudents.find(s => s.id === id);
            const progress = studentsDataCache[email];

            let details = `–ê—Ç—ã: ${student.name}\n`;
            details += `Email: ${student.email}\n`;
            details += `–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω –∫“Ø–Ω—ñ: ${student.date_joined}\n`;
            details += `–ñ–∞–ª–ø—ã –ø—Ä–æ–≥—Ä–µ—Å—Å: ${progress.avgProgress}%\n`;
            details += `–û—Ä—Ç–∞—à–∞ –±–∞–ª–ª: ${progress.avgScore}%\n`;
            details += `–ê—è“õ—Ç–∞–ª“ì–∞–Ω –∫—É—Ä—Å—Ç–∞—Ä: ${progress.completedCourses}\n`;
            details += `–û“õ—É —É–∞“õ—ã—Ç—ã: ${(progress.totalTime / 3600).toFixed(1)} —Å–∞“ì–∞—Ç\n`;
            details += `–¢–∞–º–∞—à–∞ —Ç–µ—Å—Ç—Ç–µ—Ä: ${progress.perfectScores}\n`;

            alert(details);
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
        async function toggleStudentStatus(id, newStatus) {
            try {
                const response = await fetch('/api/admin/students/status/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        student_id: id,
                        is_active: newStatus
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('‚úÖ ' + data.message);
                    loadStudents();
                } else {
                    alert('‚ùå ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå –ú”ô—Ä—Ç–µ–±–µ–Ω—ñ ”©–∑–≥–µ—Ä—Ç—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
        async function deleteStudent(id) {
            if (!confirm('–ë“±–ª –æ“õ—É—à—ã–Ω—ã –∂–æ–π“ì—ã“£—ã–∑ –∫–µ–ª–µ—Ç—ñ–Ω—ñ–Ω–µ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ? –ë“±–ª ”ô—Ä–µ–∫–µ—Ç—Ç—ñ –±–æ–ª–¥—ã—Ä–º–∞—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å.')) {
                return;
            }

            try {
                const response = await fetch('/api/admin/students/delete/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        student_id: id
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('‚úÖ ' + data.message);
                    loadStudents();
                } else {
                    alert('‚ùå ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå –û“õ—É—à—ã–Ω—ã –∂–æ—é –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ');
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openAddStudentModal() {
            document.getElementById('studentModalTitle').textContent = '–û“õ—É—à—ã “õ–æ—Å—É';
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
            document.getElementById('studentModal').classList.add('active');
        }

        function closeStudentModal() {
            document.getElementById('studentModal').classList.remove('active');
        }

        function openAddTeacherModal() {
            document.getElementById('teacherModalTitle').textContent = '–ú“±“ì–∞–ª—ñ–º “õ–æ—Å—É';
            document.getElementById('teacherForm').reset();
            document.getElementById('teacherId').value = '';
            document.getElementById('teacherModal').classList.add('active');
        }

        function closeTeacherModal() {
            document.getElementById('teacherModal').classList.remove('active');
        }

        function viewTeacher(id) {
            const teacher = allTeachers.find(t => t.id === id);
            if (!teacher) return;

            let details = `–ê—Ç—ã: ${teacher.name}\n`;
            details += `Email: ${teacher.email}\n`;
            details += `–ö—É—Ä—Å: ${teacher.course_name || '–¢–∞“ì–∞–π—ã–Ω–¥–∞–ª–º–∞“ì–∞–Ω'}\n`;
            details += `–û“õ—É—à—ã —Å–∞–Ω—ã: ${teacher.students_count || 0}\n`;
            details += `–°–∞–±–∞“õ—Ç–∞—Ä: ${teacher.lessons_count || 0}\n`;

            alert(details);
        }

        async function deleteTeacher(id) {
            if (!confirm('–ë“±–ª –º“±“ì–∞–ª—ñ–º–¥—ñ –∂–æ–π“ì—ã“£—ã–∑ –∫–µ–ª–µ—Ç—ñ–Ω—ñ–Ω–µ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ? –ë–∞—Ä–ª—ã“õ —Å–∞–±–∞“õ—Ç–∞—Ä—ã –º–µ–Ω –±–∞“ì–∞–ª–∞—Ä—ã –¥–∞ –∂–æ–π—ã–ª–∞–¥—ã.')) {
                return;
            }

            try {
                const response = await fetch('/api/admin/teachers/delete/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        teacher_id: id
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('‚úÖ ' + data.message);
                    loadTeachers();
                    updateTeacherStats();
                } else {
                    alert('‚ùå ' + (data.error || data.message));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå –ú“±“ì–∞–ª—ñ–º–¥—ñ –∂–æ—é –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ');
            }
        }

        // Handle Student Form Submit
        document.getElementById('studentForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('studentId').value;
            const name = document.getElementById('studentName').value;
            const email = document.getElementById('studentEmail').value;
            const password = document.getElementById('studentPassword').value;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!name || !email) {
                alert('‚ùå –ë–∞—Ä–ª—ã“õ –º—ñ–Ω–¥–µ—Ç—Ç—ñ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑');
                return;
            }

            if (!id && !password) {
                alert('‚ùå –ñ–∞“£–∞ –æ“õ—É—à—ã “Ø—à—ñ–Ω “õ“±–ø–∏—è —Å”©–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑');
                return;
            }

            try {
                const response = await fetch('/api/admin/students/create/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        full_name: name,
                        email: email,
                        password: password
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('‚úÖ ' + data.message);
                    closeStudentModal();
                    loadStudents();
                } else {
                    alert('‚ùå ' + (data.message || data.error));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå –û“õ—É—à—ã–Ω—ã –∂–∞—Å–∞—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ');
            }
        });

        // Handle Teacher Form Submit
        document.getElementById('teacherForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('teacherName').value;
            const email = document.getElementById('teacherEmail').value;
            const password = document.getElementById('teacherPassword').value;
            const courseId = document.getElementById('teacherCourse').value;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!name || !email || !password || !courseId) {
                alert('‚ùå –ë–∞—Ä–ª—ã“õ –º—ñ–Ω–¥–µ—Ç—Ç—ñ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑');
                return;
            }

            try {
                const response = await fetch('/api/admin/teachers/create/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        full_name: name,
                        email: email,
                        password: password,
                        course_id: parseInt(courseId)
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('‚úÖ ' + data.message);
                    closeTeacherModal();
                    loadTeachers();
                    updateTeacherStats();
                } else {
                    alert('‚ùå ' + (data.message || data.error));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå –ú“±“ì–∞–ª—ñ–º–¥—ñ –∂–∞—Å–∞—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ');
            }
        });

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function exportData() {
            try {
                const data = {
                    students: allStudents,
                    teachers: allTeachers,
                    exportDate: new Date().toISOString(),
                    stats: {
                        totalStudents: allStudents.length,
                        totalTeachers: allTeachers.length,
                        totalCourses: 4
                    }
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `codenest-data-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                alert('üì• –î–µ—Ä–µ–∫—Ç–µ—Ä —Å”ô—Ç—Ç—ñ —ç–∫—Å–ø–æ—Ä—Ç—Ç–∞–ª–¥—ã!');
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —ç–∫—Å–ø–æ—Ä—Ç—Ç–∞—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ');
            }
        }

        // –í—ã—Ö–æ–¥
        async function handleLogout() {
            if (!confirm('–®—ã“õ“õ—ã“£—ã–∑ –∫–µ–ª–µ—Ç—ñ–Ω—ñ–Ω–µ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) {
                return;
            }

            try {
                const response = await fetch('/logout/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Logout error:', error);
                alert('–®—ã“ì—É –∫–µ–∑—ñ–Ω–¥–µ–≥—ñ “õ–∞—Ç–µ');
            }
        }
    </script>
</body>
</html>